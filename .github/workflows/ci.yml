name: Entur/Meta/CI

on:
  pull_request:

jobs:
  generate-doc-for-auto-doc:
    uses: ./.github/workflows/auto-doc.yml
    with:
      workflow_file: .github/workflows/auto-doc.yml
      readme_file: README-auto-doc.md
  generate-doc-for-release:
    uses: ./.github/workflows/auto-doc.yml
    with:
      workflow_file: .github/workflows/release.yml
      readme_file: README-release.md

  # Run tests on actions
  test-local-actions:
    runs-on: ubuntu-24.04
    environment: dev
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/cloud-auth
        with:
          environment: dev
          cloud_provider: gcp
          gcp_workload_identity_provider: ${{ vars.WORKLOAD_IDENTITY_PROVIDER }}
          gcp_service_account: ${{ vars.SERVICE_ACCOUNT }}
      - uses: ./.github/actions/k8s-auth
        with:
          environment: dev
          cloud_provider: gcp
      - uses: ./.github/actions/docker-auth.yml
        with:
          environment: dev
          cloud_provider: gcp
          workload_identity_provider: ${{ vars.CI_WORKLOAD_IDENTITY_PROVIDER }}
          service_account: ${{ vars.CI_SERVICE_ACCOUNT }}
